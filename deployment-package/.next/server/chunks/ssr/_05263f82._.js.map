{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-dom.ts","turbopack:///[project]/components/CheckoutForm/CheckoutForm.module.css [app-ssr] (css module)","../../../../components/CheckoutForm/CheckoutForm.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactDOM\n","__turbopack_context__.v({\n  \"cancelButton\": \"CheckoutForm-module__ymEITq__cancelButton\",\n  \"checkoutForm\": \"CheckoutForm-module__ymEITq__checkoutForm\",\n  \"errorMessage\": \"CheckoutForm-module__ymEITq__errorMessage\",\n  \"formActions\": \"CheckoutForm-module__ymEITq__formActions\",\n  \"formGroup\": \"CheckoutForm-module__ymEITq__formGroup\",\n  \"helpText\": \"CheckoutForm-module__ymEITq__helpText\",\n  \"input\": \"CheckoutForm-module__ymEITq__input\",\n  \"label\": \"CheckoutForm-module__ymEITq__label\",\n  \"submitButton\": \"CheckoutForm-module__ymEITq__submitButton\",\n});\n","/**\n * Composant : CheckoutForm\n * \n * Ce composant gère le formulaire de saisie de l'email et la création\n * de la session Stripe Checkout.\n * \n * FLUX DE TRAVAIL :\n * 1. L'utilisateur saisit son email\n * 2. Validation de l'email (format basique)\n * 3. Appel à l'API /api/checkout avec productId et email\n * 4. L'API crée l'Order en base et la session Stripe\n * 5. Redirection automatique vers la page de paiement Stripe\n * \n * NOTE : Ce composant est un Client Component car il gère :\n * - L'état du formulaire (useState)\n * - Les interactions utilisateur (onSubmit, onChange)\n * - La navigation (useRouter)\n */\n\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport styles from \"./CheckoutForm.module.css\";\n\ninterface CheckoutFormProps {\n  productId: number; // ID de l'album à commander\n}\n\nexport default function CheckoutForm({ productId }: CheckoutFormProps) {\n  // État du formulaire\n  const [email, setEmail] = useState(\"\"); // Email saisi par l'utilisateur\n  const [loading, setLoading] = useState(false); // État de chargement pendant la requête\n  const [error, setError] = useState<string | null>(null); // Message d'erreur éventuel\n  const router = useRouter();\n\n  /**\n   * Gestion de la soumission du formulaire\n   * \n   * Cette fonction est appelée quand l'utilisateur clique sur \"Procéder au paiement\"\n   */\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault(); // Empêche le rechargement de la page\n    setLoading(true); // Active l'état de chargement\n    setError(null); // Réinitialise les erreurs\n\n    // Validation basique de l'email (vérifie la présence d'un @)\n    if (!email || !email.includes(\"@\")) {\n      setError(\"Veuillez entrer une adresse email valide\");\n      setLoading(false);\n      return;\n    }\n\n    try {\n      /**\n       * APPEL À L'API /api/checkout\n       * \n       * Cette API va :\n       * - Récupérer le produit depuis la base de données\n       * - Créer une Order en statut \"pending\"\n       * - Créer un OrderItem associé\n       * - Créer une session Stripe Checkout\n       * - Retourner l'URL de la session Stripe\n       */\n      const response = await fetch(\"/api/checkout\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          productId,\n          email,\n        }),\n      });\n\n      const data = await response.json();\n\n      // Vérification de la réponse de l'API\n      if (!response.ok) {\n        throw new Error(data.error || \"Erreur lors de la création de la commande\");\n      }\n\n      /**\n       * REDIRECTION VERS STRIPE CHECKOUT\n       * \n       * Si tout s'est bien passé, on redirige l'utilisateur vers\n       * la page de paiement Stripe hébergée par Stripe.\n       * Après le paiement, Stripe redirigera vers success_url ou cancel_url\n       * configurées dans l'API checkout.\n       */\n      if (data.url) {\n        window.location.href = data.url;\n      } else {\n        throw new Error(\"URL de checkout non disponible\");\n      }\n    } catch (err) {\n      // Gestion des erreurs : affichage du message d'erreur à l'utilisateur\n      console.error(\"Checkout error:\", err);\n      setError(err instanceof Error ? err.message : \"Une erreur est survenue\");\n      setLoading(false); // Désactive l'état de chargement pour permettre une nouvelle tentative\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className={styles.checkoutForm}>\n      {/* Champ de saisie de l'email */}\n      <div className={styles.formGroup}>\n        <label htmlFor=\"email\" className={styles.label}>\n          Adresse email *\n        </label>\n        <input\n          type=\"email\"\n          id=\"email\"\n          name=\"email\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)} // Mise à jour de l'état à chaque saisie\n          className={styles.input}\n          placeholder=\"votre.email@exemple.com\"\n          required\n          disabled={loading} // Désactivé pendant le chargement\n        />\n        <p className={styles.helpText}>\n          Vous recevrez la confirmation de commande à cette adresse\n        </p>\n      </div>\n\n      {/* Affichage des erreurs si présentes */}\n      {error && <div className={styles.errorMessage}>{error}</div>}\n\n      {/* Boutons d'action */}\n      <div className={styles.formActions}>\n        {/* Bouton Retour : retourne à la page précédente */}\n        <button\n          type=\"button\"\n          onClick={() => router.back()}\n          className={styles.cancelButton}\n          disabled={loading}\n        >\n          Retour\n        </button>\n        {/* Bouton de soumission : lance le processus de checkout */}\n        <button\n          type=\"submit\"\n          className={styles.submitButton}\n          disabled={loading || !email} // Désactivé si chargement en cours ou email vide\n        >\n          {loading ? \"Traitement...\" : \"Procéder au paiement\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n"],"names":["module","exports","require","vendored","ReactDOM"],"mappings":"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","ignoreList":[0]}