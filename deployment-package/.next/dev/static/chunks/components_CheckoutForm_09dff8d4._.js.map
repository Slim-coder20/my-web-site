{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/components/CheckoutForm/CheckoutForm.module.css [app-client] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"cancelButton\": \"CheckoutForm-module__ymEITq__cancelButton\",\n  \"checkoutForm\": \"CheckoutForm-module__ymEITq__checkoutForm\",\n  \"errorMessage\": \"CheckoutForm-module__ymEITq__errorMessage\",\n  \"formActions\": \"CheckoutForm-module__ymEITq__formActions\",\n  \"formGroup\": \"CheckoutForm-module__ymEITq__formGroup\",\n  \"helpText\": \"CheckoutForm-module__ymEITq__helpText\",\n  \"input\": \"CheckoutForm-module__ymEITq__input\",\n  \"label\": \"CheckoutForm-module__ymEITq__label\",\n  \"submitButton\": \"CheckoutForm-module__ymEITq__submitButton\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Slim%20Backup/Projets/Dossier%20Professionel%20Studi%202026%20/slim_site_internet/my-web-site/components/CheckoutForm/CheckoutForm.tsx"],"sourcesContent":["/**\n * Composant : CheckoutForm\n * \n * Ce composant gère le formulaire de saisie de l'email et la création\n * de la session Stripe Checkout.\n * \n * FLUX DE TRAVAIL :\n * 1. L'utilisateur saisit son email\n * 2. Validation de l'email (format basique)\n * 3. Appel à l'API /api/checkout avec productId et email\n * 4. L'API crée l'Order en base et la session Stripe\n * 5. Redirection automatique vers la page de paiement Stripe\n * \n * NOTE : Ce composant est un Client Component car il gère :\n * - L'état du formulaire (useState)\n * - Les interactions utilisateur (onSubmit, onChange)\n * - La navigation (useRouter)\n */\n\n\"use client\";\n\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport styles from \"./CheckoutForm.module.css\";\n\ninterface CheckoutFormProps {\n  productId: number; // ID de l'album à commander\n}\n\nexport default function CheckoutForm({ productId }: CheckoutFormProps) {\n  // État du formulaire\n  const [email, setEmail] = useState(\"\"); // Email saisi par l'utilisateur\n  const [loading, setLoading] = useState(false); // État de chargement pendant la requête\n  const [error, setError] = useState<string | null>(null); // Message d'erreur éventuel\n  const router = useRouter();\n\n  /**\n   * Gestion de la soumission du formulaire\n   * \n   * Cette fonction est appelée quand l'utilisateur clique sur \"Procéder au paiement\"\n   */\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault(); // Empêche le rechargement de la page\n    setLoading(true); // Active l'état de chargement\n    setError(null); // Réinitialise les erreurs\n\n    // Validation basique de l'email (vérifie la présence d'un @)\n    if (!email || !email.includes(\"@\")) {\n      setError(\"Veuillez entrer une adresse email valide\");\n      setLoading(false);\n      return;\n    }\n\n    try {\n      /**\n       * APPEL À L'API /api/checkout\n       * \n       * Cette API va :\n       * - Récupérer le produit depuis la base de données\n       * - Créer une Order en statut \"pending\"\n       * - Créer un OrderItem associé\n       * - Créer une session Stripe Checkout\n       * - Retourner l'URL de la session Stripe\n       */\n      const response = await fetch(\"/api/checkout\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          productId,\n          email,\n        }),\n      });\n\n      const data = await response.json();\n\n      // Vérification de la réponse de l'API\n      if (!response.ok) {\n        throw new Error(data.error || \"Erreur lors de la création de la commande\");\n      }\n\n      /**\n       * REDIRECTION VERS STRIPE CHECKOUT\n       * \n       * Si tout s'est bien passé, on redirige l'utilisateur vers\n       * la page de paiement Stripe hébergée par Stripe.\n       * Après le paiement, Stripe redirigera vers success_url ou cancel_url\n       * configurées dans l'API checkout.\n       */\n      if (data.url) {\n        window.location.href = data.url;\n      } else {\n        throw new Error(\"URL de checkout non disponible\");\n      }\n    } catch (err) {\n      // Gestion des erreurs : affichage du message d'erreur à l'utilisateur\n      console.error(\"Checkout error:\", err);\n      setError(err instanceof Error ? err.message : \"Une erreur est survenue\");\n      setLoading(false); // Désactive l'état de chargement pour permettre une nouvelle tentative\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className={styles.checkoutForm}>\n      {/* Champ de saisie de l'email */}\n      <div className={styles.formGroup}>\n        <label htmlFor=\"email\" className={styles.label}>\n          Adresse email *\n        </label>\n        <input\n          type=\"email\"\n          id=\"email\"\n          name=\"email\"\n          value={email}\n          onChange={(e) => setEmail(e.target.value)} // Mise à jour de l'état à chaque saisie\n          className={styles.input}\n          placeholder=\"votre.email@exemple.com\"\n          required\n          disabled={loading} // Désactivé pendant le chargement\n        />\n        <p className={styles.helpText}>\n          Vous recevrez la confirmation de commande à cette adresse\n        </p>\n      </div>\n\n      {/* Affichage des erreurs si présentes */}\n      {error && <div className={styles.errorMessage}>{error}</div>}\n\n      {/* Boutons d'action */}\n      <div className={styles.formActions}>\n        {/* Bouton Retour : retourne à la page précédente */}\n        <button\n          type=\"button\"\n          onClick={() => router.back()}\n          className={styles.cancelButton}\n          disabled={loading}\n        >\n          Retour\n        </button>\n        {/* Bouton de soumission : lance le processus de checkout */}\n        <button\n          type=\"submit\"\n          className={styles.submitButton}\n          disabled={loading || !email} // Désactivé si chargement en cours ou email vide\n        >\n          {loading ? \"Traitement...\" : \"Procéder au paiement\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;CAiBC;;;;;AAID;AACA;AACA;;;AAJA;;;;AAUe,SAAS,aAAa,EAAE,SAAS,EAAqB;;IACnE,qBAAqB;IACrB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC,KAAK,gCAAgC;IACxE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC,QAAQ,wCAAwC;IACvF,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAgB,OAAO,4BAA4B;IACrF,MAAM,SAAS,IAAA,kJAAS;IAExB;;;;GAIC,GACD,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc,IAAI,qCAAqC;QACzD,WAAW,OAAO,8BAA8B;QAChD,SAAS,OAAO,2BAA2B;QAE3C,6DAA6D;QAC7D,IAAI,CAAC,SAAS,CAAC,MAAM,QAAQ,CAAC,MAAM;YAClC,SAAS;YACT,WAAW;YACX;QACF;QAEA,IAAI;YACF;;;;;;;;;OASC,GACD,MAAM,WAAW,MAAM,MAAM,iBAAiB;gBAC5C,QAAQ;gBACR,SAAS;oBACP,gBAAgB;gBAClB;gBACA,MAAM,KAAK,SAAS,CAAC;oBACnB;oBACA;gBACF;YACF;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,sCAAsC;YACtC,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI;YAChC;YAEA;;;;;;;OAOC,GACD,IAAI,KAAK,GAAG,EAAE;gBACZ,OAAO,QAAQ,CAAC,IAAI,GAAG,KAAK,GAAG;YACjC,OAAO;gBACL,MAAM,IAAI,MAAM;YAClB;QACF,EAAE,OAAO,KAAK;YACZ,sEAAsE;YACtE,QAAQ,KAAK,CAAC,mBAAmB;YACjC,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;YAC9C,WAAW,QAAQ,uEAAuE;QAC5F;IACF;IAEA,qBACE,6LAAC;QAAK,UAAU;QAAc,WAAW,oKAAM,CAAC,YAAY;;0BAE1D,6LAAC;gBAAI,WAAW,oKAAM,CAAC,SAAS;;kCAC9B,6LAAC;wBAAM,SAAQ;wBAAQ,WAAW,oKAAM,CAAC,KAAK;kCAAE;;;;;;kCAGhD,6LAAC;wBACC,MAAK;wBACL,IAAG;wBACH,MAAK;wBACL,OAAO;wBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBACxC,WAAW,oKAAM,CAAC,KAAK;wBACvB,aAAY;wBACZ,QAAQ;wBACR,UAAU;;;;;;kCAEZ,6LAAC;wBAAE,WAAW,oKAAM,CAAC,QAAQ;kCAAE;;;;;;;;;;;;YAMhC,uBAAS,6LAAC;gBAAI,WAAW,oKAAM,CAAC,YAAY;0BAAG;;;;;;0BAGhD,6LAAC;gBAAI,WAAW,oKAAM,CAAC,WAAW;;kCAEhC,6LAAC;wBACC,MAAK;wBACL,SAAS,IAAM,OAAO,IAAI;wBAC1B,WAAW,oKAAM,CAAC,YAAY;wBAC9B,UAAU;kCACX;;;;;;kCAID,6LAAC;wBACC,MAAK;wBACL,WAAW,oKAAM,CAAC,YAAY;wBAC9B,UAAU,WAAW,CAAC;kCAErB,UAAU,kBAAkB;;;;;;;;;;;;;;;;;;AAKvC;GA1HwB;;QAKP,kJAAS;;;KALF"}}]
}