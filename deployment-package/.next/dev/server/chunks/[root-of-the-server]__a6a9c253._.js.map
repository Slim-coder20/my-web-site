{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/Slim%20Backup/Projets/Dossier%20Professionel%20Studi%202026%20/slim_site_internet/my-web-site/app/api/contact/route.ts"],"sourcesContent":["// Cette route est utilisée pour envoyer un email depuis le formulaire de contact\n\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { Resend } from \"resend\";\n\n// Vérification de la clé API Resend\nif (!process.env.RESEND_API_KEY) {\n  console.error(\n    \"RESEND_API_KEY n'est pas définie dans les variables d'environnement\"\n  );\n}\n\nconst resend = new Resend(process.env.RESEND_API_KEY);\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Vérification de la clé API\n    if (!process.env.RESEND_API_KEY) {\n      console.error(\"RESEND_API_KEY manquante\");\n      return NextResponse.json(\n        { error: \"Configuration serveur manquante\" },\n        { status: 500 }\n      );\n    }\n\n    // Récupération des données du formulaire\n    const { name, email, subject, message } = await request.json();\n\n    // Validation des champs requis\n    if (!name || !email || !message || !subject) {\n      return NextResponse.json(\n        { error: \"Tous les champs sont requis (nom, email, sujet, message)\" },\n        { status: 400 }\n      );\n    }\n\n    // Validation de l'email\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return NextResponse.json(\n        { error: \"Adresse email invalide\" },\n        { status: 400 }\n      );\n    }\n\n    // En mode test, Resend ne permet d'envoyer qu'à l'adresse email du compte\n    // Pour la production, il faut vérifier un domaine sur resend.com/domains\n    const contactEmail =\n      process.env.CONTACT_EMAIL || \"slimabidaproject@gmail.com\";\n\n    // En développement/test, utiliser l'adresse email du compte Resend\n    // (Remplacez par votre adresse email associée au compte Resend)\n    const recipientEmail =\n      process.env.NODE_ENV === \"development\"\n        ? process.env.RESEND_TEST_EMAIL || \"slimdev20@gmail.com\" // Email du compte Resend pour les tests\n        : contactEmail; // Email de production\n\n    // Fonction pour échapper le HTML (sécurité)\n    const escapeHtml = (text: string): string => {\n      const map: { [key: string]: string } = {\n        \"&\": \"&amp;\",\n        \"<\": \"&lt;\",\n        \">\": \"&gt;\",\n        '\"': \"&quot;\",\n        \"'\": \"&#039;\",\n      };\n      return text.replace(/[&<>\"']/g, (m) => map[m]);\n    };\n\n    // Échapper les données pour éviter les injections HTML\n    const safeName = escapeHtml(name);\n    const safeEmail = escapeHtml(email);\n    const safeSubject = escapeHtml(subject || \"Non spécifié\");\n    const safeMessage = escapeHtml(message).replace(/\\n/g, \"<br>\");\n\n    // Envoi de l'email via Resend\n    const response = await resend.emails.send({\n      from: \"onboarding@resend.dev\", // Email d'envoi (à changer si vous avez un domaine vérifié)\n      to: recipientEmail, // Email de réception (adapté selon l'environnement)\n      subject: safeSubject || \"Nouveau message depuis le formulaire de contact\",\n      html: `\n        <h2>Nouveau message de contact</h2>\n        <p><strong>Nom:</strong> ${safeName}</p>\n        <p><strong>Email:</strong> ${safeEmail}</p>\n        <p><strong>Sujet:</strong> ${safeSubject}</p>\n        <p><strong>Message:</strong></p>\n        <p>${safeMessage}</p>\n        ${\n          process.env.NODE_ENV === \"development\"\n            ? `<p><em>Note: Email envoyé en mode test. Le destinataire réel serait: ${contactEmail}</em></p>`\n            : \"\"\n        }\n      `,\n    });\n\n    // Vérification de la réponse\n    if (response.error) {\n      console.error(\"Erreur Resend:\", response.error);\n      console.error(\n        \"Détails de l'erreur:\",\n        JSON.stringify(response.error, null, 2)\n      );\n\n      // Message d'erreur plus explicite selon le type d'erreur\n      if (response.error.statusCode === 403) {\n        return NextResponse.json(\n          {\n            error:\n              \"Limitation Resend: En mode test, vous ne pouvez envoyer qu'à votre adresse email de compte. Pour envoyer à d'autres adresses, vérifiez un domaine sur resend.com/domains\",\n          },\n          { status: 403 }\n        );\n      }\n\n      if (response.error.statusCode === 500) {\n        // Erreur serveur Resend - peut être temporaire\n        console.error(\"Erreur serveur Resend (500) - peut être temporaire\");\n        return NextResponse.json(\n          {\n            error:\n              \"Erreur temporaire du service d'envoi d'email. Veuillez réessayer dans quelques instants.\",\n          },\n          { status: 500 }\n        );\n      }\n\n      // Autres erreurs\n      return NextResponse.json(\n        {\n          error: response.error.message || \"Erreur lors de l'envoi de l'email\",\n          details:\n            process.env.NODE_ENV === \"development\" ? response.error : undefined,\n        },\n        { status: response.error.statusCode || 500 }\n      );\n    }\n\n    // Retourner une réponse de succès\n    return NextResponse.json(\n      { message: \"Email envoyé avec succès\", id: response.data?.id },\n      { status: 200 }\n    );\n  } catch (error) {\n    // Logger l'erreur pour le débogage\n    console.error(\"Erreur lors de l'envoi de l'email:\", error);\n\n    // Retourner un message d'erreur plus détaillé en développement\n    const errorMessage =\n      process.env.NODE_ENV === \"development\"\n        ? error instanceof Error\n          ? error.message\n          : \"Erreur serveur lors de l'envoi de l'email\"\n        : \"Erreur serveur lors de l'envoi de l'email\";\n\n    return NextResponse.json({ error: errorMessage }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}