// Prisma schema for Discography e‑commerce (PostgreSQL)
// Models: Product, Order, OrderItem, Concert, Video

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql" // Changé de MySQL à PostgreSQL pour Supabase
  url      = env("DATABASE_URL")
  // Note: Pour Supabase pooler, la connection string doit contenir ?pgbouncer=true
  // Format: postgresql://...@pooler.supabase.com:6543/postgres?pgbouncer=true
}

model Product {
  id          Int         @id @default(autoincrement())
  slug        String      @unique
  title       String
  description String?
  priceCents  Int
  coverUrl    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  orderItems  OrderItem[]
}

model Order {
  id              Int         @id @default(autoincrement())
  email           String
  stripeSessionId String?     @unique
  amountTotal     Int
  status          String
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  items           OrderItem[]
}

model OrderItem {
  id        Int @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int @default(1)
  unitPrice Int

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

/**
 * Modèle Concert pour la gestion dynamique des concerts
 * TODO: À implémenter plus tard pour remplacer les données statiques
 * Champs prévus :
 * - id : Identifiant unique
 * - title : Titre du concert
 * - date : Date du concert (format DateTime pour tri chronologique)
 * - location : Lieu du concert (ville, pays)
 * - imageUrl : URL de l'image du concert
 * - imageAlt : Texte alternatif pour l'image
 * - description : Description optionnelle du concert
 * - venue : Nom de la salle/venue (optionnel)
 * - ticketUrl : URL pour acheter les billets (optionnel)
 * - createdAt / updatedAt : Timestamps automatiques
 */
model Concert {
  id          Int      @id @default(autoincrement())
  title       String
  date        DateTime // Date et heure du concert
  location    String // Format: "Ville, Pays"
  imageUrl    String?
  imageAlt    String?
  description String?
  venue       String? // Nom de la salle/venue
  ticketUrl   String? // Lien pour acheter les billets
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

/**
 * Modèle Video pour la gestion dynamique des vidéos
 * TODO: À implémenter plus tard pour remplacer les données statiques
 * Champs prévus :
 * - id : Identifiant unique
 * - title : Titre de la vidéo
 * - description : Description de la vidéo (optionnel)
 * - videoUrl : Chemin/URL vers le fichier vidéo (ex: "/videos/butterfly-video.mp4")
 * - videoType : Type MIME de la vidéo (ex: "video/mp4", "video/mov", "video/webm")
 * - thumbnailUrl : URL de la miniature/aperçu (optionnel)
 * - duration : Durée de la vidéo en secondes (optionnel)
 * - createdAt / updatedAt : Timestamps automatiques
 */
model Video {
  id           Int      @id @default(autoincrement())
  title        String
  description  String? // Description de la vidéo
  videoUrl     String // Chemin vers le fichier vidéo (ex: "/videos/butterfly-video.mp4")
  videoType    String // Type MIME (ex: "video/mp4", "video/mov", "video/webm")
  thumbnailUrl String? // URL de la miniature/aperçu
  duration     Int? // Durée en secondes (optionnel)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
